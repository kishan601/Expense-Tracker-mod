{"ast":null,"code":"// src/retryer.ts\nimport { focusManager } from \"./focusManager.js\";\nimport { onlineManager } from \"./onlineManager.js\";\nimport { pendingThenable } from \"./thenable.js\";\nimport { isServer, sleep } from \"./utils.js\";\nfunction defaultRetryDelay(failureCount) {\n  return Math.min(1e3 * 2 ** failureCount, 3e4);\n}\nfunction canFetch(networkMode) {\n  return (networkMode ?? \"online\") === \"online\" ? onlineManager.isOnline() : true;\n}\nvar CancelledError = class extends Error {\n  constructor(options) {\n    super(\"CancelledError\");\n    this.revert = options?.revert;\n    this.silent = options?.silent;\n  }\n};\nfunction isCancelledError(value) {\n  return value instanceof CancelledError;\n}\nfunction createRetryer(config) {\n  let isRetryCancelled = false;\n  let failureCount = 0;\n  let isResolved = false;\n  let continueFn;\n  const thenable = pendingThenable();\n  const cancel = cancelOptions => {\n    if (!isResolved) {\n      reject(new CancelledError(cancelOptions));\n      config.abort?.();\n    }\n  };\n  const cancelRetry = () => {\n    isRetryCancelled = true;\n  };\n  const continueRetry = () => {\n    isRetryCancelled = false;\n  };\n  const canContinue = () => focusManager.isFocused() && (config.networkMode === \"always\" || onlineManager.isOnline()) && config.canRun();\n  const canStart = () => canFetch(config.networkMode) && config.canRun();\n  const resolve = value => {\n    if (!isResolved) {\n      isResolved = true;\n      config.onSuccess?.(value);\n      continueFn?.();\n      thenable.resolve(value);\n    }\n  };\n  const reject = value => {\n    if (!isResolved) {\n      isResolved = true;\n      config.onError?.(value);\n      continueFn?.();\n      thenable.reject(value);\n    }\n  };\n  const pause = () => {\n    return new Promise(continueResolve => {\n      continueFn = value => {\n        if (isResolved || canContinue()) {\n          continueResolve(value);\n        }\n      };\n      config.onPause?.();\n    }).then(() => {\n      continueFn = void 0;\n      if (!isResolved) {\n        config.onContinue?.();\n      }\n    });\n  };\n  const run = () => {\n    if (isResolved) {\n      return;\n    }\n    let promiseOrValue;\n    const initialPromise = failureCount === 0 ? config.initialPromise : void 0;\n    try {\n      promiseOrValue = initialPromise ?? config.fn();\n    } catch (error) {\n      promiseOrValue = Promise.reject(error);\n    }\n    Promise.resolve(promiseOrValue).then(resolve).catch(error => {\n      if (isResolved) {\n        return;\n      }\n      const retry = config.retry ?? (isServer ? 0 : 3);\n      const retryDelay = config.retryDelay ?? defaultRetryDelay;\n      const delay = typeof retryDelay === \"function\" ? retryDelay(failureCount, error) : retryDelay;\n      const shouldRetry = retry === true || typeof retry === \"number\" && failureCount < retry || typeof retry === \"function\" && retry(failureCount, error);\n      if (isRetryCancelled || !shouldRetry) {\n        reject(error);\n        return;\n      }\n      failureCount++;\n      config.onFail?.(failureCount, error);\n      sleep(delay).then(() => {\n        return canContinue() ? void 0 : pause();\n      }).then(() => {\n        if (isRetryCancelled) {\n          reject(error);\n        } else {\n          run();\n        }\n      });\n    });\n  };\n  return {\n    promise: thenable,\n    cancel,\n    continue: () => {\n      continueFn?.();\n      return thenable;\n    },\n    cancelRetry,\n    continueRetry,\n    canStart,\n    start: () => {\n      if (canStart()) {\n        run();\n      } else {\n        pause().then(run);\n      }\n      return thenable;\n    }\n  };\n}\nexport { CancelledError, canFetch, createRetryer, isCancelledError };","map":{"version":3,"names":["focusManager","onlineManager","pendingThenable","isServer","sleep","defaultRetryDelay","failureCount","Math","min","canFetch","networkMode","isOnline","CancelledError","Error","constructor","options","revert","silent","isCancelledError","value","createRetryer","config","isRetryCancelled","isResolved","continueFn","thenable","cancel","cancelOptions","reject","abort","cancelRetry","continueRetry","canContinue","isFocused","canRun","canStart","resolve","onSuccess","onError","pause","Promise","continueResolve","onPause","then","onContinue","run","promiseOrValue","initialPromise","fn","error","catch","retry","retryDelay","delay","shouldRetry","onFail","promise","continue","start"],"sources":["D:/GitHub/expense-tracker/expense-tracker/node_modules/@tanstack/query-core/build/modern/retryer.js"],"sourcesContent":["// src/retryer.ts\nimport { focusManager } from \"./focusManager.js\";\nimport { onlineManager } from \"./onlineManager.js\";\nimport { pendingThenable } from \"./thenable.js\";\nimport { isServer, sleep } from \"./utils.js\";\nfunction defaultRetryDelay(failureCount) {\n  return Math.min(1e3 * 2 ** failureCount, 3e4);\n}\nfunction canFetch(networkMode) {\n  return (networkMode ?? \"online\") === \"online\" ? onlineManager.isOnline() : true;\n}\nvar CancelledError = class extends Error {\n  constructor(options) {\n    super(\"CancelledError\");\n    this.revert = options?.revert;\n    this.silent = options?.silent;\n  }\n};\nfunction isCancelledError(value) {\n  return value instanceof CancelledError;\n}\nfunction createRetryer(config) {\n  let isRetryCancelled = false;\n  let failureCount = 0;\n  let isResolved = false;\n  let continueFn;\n  const thenable = pendingThenable();\n  const cancel = (cancelOptions) => {\n    if (!isResolved) {\n      reject(new CancelledError(cancelOptions));\n      config.abort?.();\n    }\n  };\n  const cancelRetry = () => {\n    isRetryCancelled = true;\n  };\n  const continueRetry = () => {\n    isRetryCancelled = false;\n  };\n  const canContinue = () => focusManager.isFocused() && (config.networkMode === \"always\" || onlineManager.isOnline()) && config.canRun();\n  const canStart = () => canFetch(config.networkMode) && config.canRun();\n  const resolve = (value) => {\n    if (!isResolved) {\n      isResolved = true;\n      config.onSuccess?.(value);\n      continueFn?.();\n      thenable.resolve(value);\n    }\n  };\n  const reject = (value) => {\n    if (!isResolved) {\n      isResolved = true;\n      config.onError?.(value);\n      continueFn?.();\n      thenable.reject(value);\n    }\n  };\n  const pause = () => {\n    return new Promise((continueResolve) => {\n      continueFn = (value) => {\n        if (isResolved || canContinue()) {\n          continueResolve(value);\n        }\n      };\n      config.onPause?.();\n    }).then(() => {\n      continueFn = void 0;\n      if (!isResolved) {\n        config.onContinue?.();\n      }\n    });\n  };\n  const run = () => {\n    if (isResolved) {\n      return;\n    }\n    let promiseOrValue;\n    const initialPromise = failureCount === 0 ? config.initialPromise : void 0;\n    try {\n      promiseOrValue = initialPromise ?? config.fn();\n    } catch (error) {\n      promiseOrValue = Promise.reject(error);\n    }\n    Promise.resolve(promiseOrValue).then(resolve).catch((error) => {\n      if (isResolved) {\n        return;\n      }\n      const retry = config.retry ?? (isServer ? 0 : 3);\n      const retryDelay = config.retryDelay ?? defaultRetryDelay;\n      const delay = typeof retryDelay === \"function\" ? retryDelay(failureCount, error) : retryDelay;\n      const shouldRetry = retry === true || typeof retry === \"number\" && failureCount < retry || typeof retry === \"function\" && retry(failureCount, error);\n      if (isRetryCancelled || !shouldRetry) {\n        reject(error);\n        return;\n      }\n      failureCount++;\n      config.onFail?.(failureCount, error);\n      sleep(delay).then(() => {\n        return canContinue() ? void 0 : pause();\n      }).then(() => {\n        if (isRetryCancelled) {\n          reject(error);\n        } else {\n          run();\n        }\n      });\n    });\n  };\n  return {\n    promise: thenable,\n    cancel,\n    continue: () => {\n      continueFn?.();\n      return thenable;\n    },\n    cancelRetry,\n    continueRetry,\n    canStart,\n    start: () => {\n      if (canStart()) {\n        run();\n      } else {\n        pause().then(run);\n      }\n      return thenable;\n    }\n  };\n}\nexport {\n  CancelledError,\n  canFetch,\n  createRetryer,\n  isCancelledError\n};\n//# sourceMappingURL=retryer.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}